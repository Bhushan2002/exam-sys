<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Exam</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }
      .container {
        max-width: 800px;
        margin: 50px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h2 {
        text-align: center;
        margin-bottom: 20px;
      }
      .question {
        margin-bottom: 15px;
      }
      .question p {
        font-size: 18px;
        margin: 0;
      }
      .question input[type="radio"] {
        margin-right: 10px;
      }
      button {
        display: block;
        width: 100%;
        padding: 10px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 18px;
        cursor: pointer;
      }
      button:hover {
        background-color: #218838;
      }
      .result {
        margin-top: 20px;
        padding: 10px;
        background-color: #dff0d8;
        border: 1px solid #c3e6cb;
        color: #155724;
        border-radius: 5px;
      }
      .timer {
        text-align: right;
        font-size: 18px;
        margin-bottom: 20px;
        color: #ff0000;
      }
    </style>
  </head>
  <body>
    <div class="container" id="login-container">
      <h2>Student Login</h2>
      <input
        type="text"
        id="phone"
        placeholder="Enter your phone number"
        style="width: 100%; padding: 10px; margin-bottom: 10px"
      />
      <button onclick="login()">Login</button>
    </div>

    <div class="container" id="exam-container" style="display: none">
      <h2>Online Exam</h2>

      <div id="timer" class="timer">Time Remaining: 20:00</div>

      <div id="exam">
        <!-- Questions 1-30 -->
        <div class="question">
          <p>1. What is the capital of France?</p>
          <label><input type="radio" name="q1" value="A" />A. Berlin</label
          ><br />
          <label><input type="radio" name="q1" value="B" />B. Paris</label
          ><br />
          <label><input type="radio" name="q1" value="C" />C. Madrid</label
          ><br />
          <label><input type="radio" name="q1" value="D" />D. Rome</label>
        </div>

        <div class="question">
          <p>2. ROLLBACK in a database is ________ statement?</p>
          <label><input type="radio" name="q2" value="A" /> TCL</label><br />
          <label><input type="radio" name="q2" value="B" /> DCL</label><br />
          <label><input type="radio" name="q2" value="C" /> DML</label><br />
          <label><input type="radio" name="q2" value="D" /> DDL</label>
        </div>

        <div class="question">
          <p>3. Unlike filters, queries can be saved as in a database?</p>
          <label><input type="radio" name="q3" value="A" /> objects</label
          ><br />
          <label><input type="radio" name="q3" value="B" /> filters</label
          ><br />
          <label><input type="radio" name="q3" value="C" /> database</label
          ><br />
          <label
            ><input type="radio" name="q3" value="D" /> Any of the above</label
          >
        </div>

        <div class="question">
          <p>
            4. Dr. E.F. Codd represented ______ rules that a database must obey
            if it has to be considered truly relational?
          </p>
          <label><input type="radio" name="q4" value="A" /> 10</label><br />
          <label><input type="radio" name="q4" value="B" /> 8</label><br />
          <label><input type="radio" name="q4" value="C" /> 12</label><br />
          <label><input type="radio" name="q4" value="D" /> 6</label>
        </div>

        <div class="question">
          <p>
            5. Periodically adding, changing and deleting file records is called
            file?
          </p>
          <label><input type="radio" name="q5" value="A" /> updating</label
          ><br />
          <label><input type="radio" name="q5" value="B" /> upgrading</label
          ><br />
          <label><input type="radio" name="q5" value="C" /> restructuring</label
          ><br />
          <label><input type="radio" name="q5" value="D" /> renewing</label>
        </div>

        <div class="question">
          <p>6. A tuple is a?</p>
          <label
            ><input type="radio" name="q6" value="A" /> column of a table</label
          ><br />
          <label
            ><input type="radio" name="q6" value="B" /> two-dimensional
            table</label
          ><br />
          <label
            ><input type="radio" name="q6" value="C" /> row of a table</label
          ><br />
          <label
            ><input type="radio" name="q6" value="D" /> key of a table</label
          >
        </div>
        <!-- Repeat for Questions 2-30 -->
        <!-- Add actual questions and options -->

        <button onclick="submitExam()">Submit Exam</button>

        <div id="result" class="result" style="display: none"></div>
      </div>
    </div>

    <script>
      let student_id = null; // To store the logged-in student's ID
      let timeRemaining = 1200; // 20 minutes in seconds

      // Timer functionality
      function startTimer() {
        const timerDiv = document.getElementById("timer");
        const interval = setInterval(() => {
          let minutes = Math.floor(timeRemaining / 60);
          let seconds = timeRemaining % 60;
          timerDiv.textContent = `Time Remaining: ${minutes}:${
            seconds < 10 ? "0" + seconds : seconds
          }`;

          if (timeRemaining <= 0) {
            clearInterval(interval);
            submitExam(); // Auto-submit when time runs out
          }

          timeRemaining--;
        }, 1000);
      }

      // Student login function
      function login() {
        const phone = document.getElementById("phone").value;
        if (phone.trim() === "") {
          alert("Please enter your phone number.");
          return;
        }

        // Send an AJAX request to the server for login
        fetch("http://localhost:3000/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              student_id = data.student_id; // Store the student's ID for later use
              console.log(data.student_id);
              document.getElementById("login-container").style.display = "none";
              document.getElementById("exam-container").style.display = "block";
              startTimer(); // Start the exam timer
            } else {
              alert(data.message);
            }
          })
          .catch((error) => console.error("Error:", error));
      }

      // Submit the exam
      function submitExam() {
        let score = 0;
        let totalQuestions = 30; // Adjust based on the number of questions

        // Assume all correct answers are stored here
        const correctAnswers = {
          q1: "B",
          q2: "A",
          q3: "A",
          q4: "C",
          q5: "A",
          q6: "C"
          // Add more correct answers for other questions
        };

        // Calculate the score
        for (let question in correctAnswers) {
          const userAnswer = document.querySelector(
            `input[name="${question}"]:checked`
          );
          if (userAnswer && userAnswer.value === correctAnswers[question]) {
            score++;
          }
        }

        // Send the result to the server
        fetch("http://localhost:3000/submit-result", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ student_id, score }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            } else {
              return response.json();
            }
          })
          .then((data) => {
            alert(`You scored ${score} out of ${totalQuestions}.`);
            // Optionally, you can redirect or show the result in the UI
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
  </body>
</html>
